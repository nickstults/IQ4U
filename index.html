<script>
  window.addEventListener("DOMContentLoaded", function () {
    // Form submission
    document.getElementById("quote-form").addEventListener("submit", function(event) {
      event.preventDefault();
      document.querySelectorAll('.form-step').forEach(step => step.style.display = 'none');
      document.getElementById("confirmation").style.display = "block";
      document.getElementById("progress-bar").style.width = "100%";
      document.getElementById("progress-percent").textContent = "100%";
      document.getElementById("progress-message").textContent = "Complete!";
      confetti({
        particleCount: 150,
        spread: 70,
        origin: { y: 0.6 }
      });
    });

    // Step navigation
    function nextStep(step) {
      const steps = document.querySelectorAll('.form-step');
      steps.forEach((el, i) => el.style.display = i === step ? 'block' : 'none');

      const bar = document.getElementById("progress-bar");
      let percent = 0;
      let message = "";

      if (step === 0) {
        percent = 30;
        message = '';
      } else if (step === 1) {
        percent = 60;
        message = 'Almost there!';
      } else if (step === 2) {
        percent = 90;
        message = 'So close!';
      }

      bar.style.width = `${percent}%`;
      document.getElementById("progress-percent").textContent = `${percent}%`;
      document.getElementById("progress-message").textContent = message;
    }

    function prevStep(step) {
      const steps = document.querySelectorAll('.form-step');
      steps.forEach((el, i) => el.style.display = i === (step - 1) ? 'block' : 'none');

      const bar = document.getElementById("progress-bar");
      let percent = 0;
      let message = "";

      if (step === 1) {
        percent = 30;
        message = '';
      } else if (step === 2) {
        percent = 60;
        message = 'Almost there!';
      }

      bar.style.width = `${percent}%`;
      document.getElementById("progress-percent").textContent = `${percent}%`;
      document.getElementById("progress-message").textContent = message;
    }

    // Set first step
    nextStep(0);

    // Countdown timer
    let timer = 300;
    const timerDisplay = document.getElementById("timer");
    setInterval(() => {
      if (timer > 0) {
        timer--;
        const minutes = String(Math.floor(timer / 60)).padStart(2, '0');
        const seconds = String(timer % 60).padStart(2, '0');
        timerDisplay.textContent = `${minutes}:${seconds}`;
      }
    }, 1000);

    // Expose functions to HTML buttons
    window.nextStep = nextStep;
    window.prevStep = prevStep;
  });
</script>
